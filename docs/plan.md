## Updated plan + spec (v0) with `.pm/` scaffold (docs/logs only)

### Commands

* `pm inbox <project-name> "<idea>"`
* `pm report <project-name>`

### Implementation (v1)

* Language: TypeScript
* Runtime: Node.js
* CLI is implemented in TypeScript and compiled to JavaScript for execution.

### Folder layout

* Create: `./projects/<project-name>/` (use user input as-is in v1)
* All PM scaffolding lives in: `./projects/<project-name>/.pm/` (**docs + logs only, no code**)

`.pm/` contents:

* `idea.md` — raw user idea
* `prompt.txt` — exact prompt sent to Codex
* `meta.json` — timestamp, pm version, project name
* `run.jsonl` — append-only raw event log
* `session.log` — raw terminal transcript
* `report.html` — generated report (static HTML)

Project code lives **outside** `.pm/` (root files generated by Codex, plus normal src/tests/etc).

### `pm inbox` behavior (happy path)

1. Use user input as project folder name; fail if `./projects/<project-name>/` exists.
2. Create `./projects/<project-name>/.pm/`.
3. Write `.pm/idea.md`, `.pm/meta.json`.
4. Build `.pm/prompt.txt` (includes: idea, “prototype only”, “log everything”, “work in current folder”, “don’t write anything into .pm/”).
5. `cd ./projects/<project-name>/`
6. Run: `codex exec --yolo "<contents of .pm/prompt.txt>"`
7. Capture everything:

    * stream stdout/stderr → `.pm/session.log`
    * raw events/records → `.pm/run.jsonl` (raw-first in v1; see schema below)
8. Verify (minimal) and log:

    * `package.json` → `npm test` / `npm run test`
    * python markers → `pytest`
    * else run generated CLI `--help`
9. Print status + project path + report hint.

### `run.jsonl` schema (v1, raw-first)

Goal for v1: **record raw data with minimal assumptions**.  
After we run `pm inbox` once, we inspect actual emitted data and tighten the schema in v2.

Each line:

`{ "ts": "...", "source": "...", "kind": "...", "payload": {...} }`

Required fields:

* `ts` — ISO-8601 timestamp
* `source` — where record came from (`pm`, `codex_exec`, `verify`)
* `kind` — event kind (`lifecycle`, `command`, `stdout`, `stderr`, `file_write`, `result`, etc.)
* `payload` — raw object/string data captured as-is

Hard requirement: do not drop data during capture in v1; prefer verbose/raw over normalized.

### `pm report`

1. Read `.pm/meta.json` + `.pm/run.jsonl`.
2. Write `.pm/report.html` (static):

   * header (project, time, status)
   * ordered steps with command + exit code
   * collapsible stdout/stderr blocks
   * verify results
3. Output path to `.pm/report.html`.

### Hard rule (enforced)

* Codex prompt instructs: **never create/modify files under `.pm/`**.
* `pm` itself only writes docs/logs under `.pm/`; never writes project code.
